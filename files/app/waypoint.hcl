project = "hashicraft"

runner {
  enabled = true

  data_source "git" {
    url = "git@10.10.0.20:22/hashicraft/payments.git"
    ref = "main"
    key = <<EOF
-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
EOF
  }
}

app "payments" {
  build {
    use "docker" {}

    registry {
      use "docker" {
        image = "10.10.0.10/hashicraft/payments"
        tag   = "latest"
      }
    }
  }

  deploy {
    use "kubernetes" {
      annotations = {
        "consul.hashicorp.com/connect-inject"  = "true"
        "consul.hashicorp.com/connect-service" = "payments"
      }

      labels = {
        "group" = "payments"
      }

      service_account = "payments"
    }
  }
}